<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>منصة صحي+ | تطبيق الهاتف</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script type="module">
        // استيراد مكتبات Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            getDocs, 
            query, 
            where, 
            orderBy, 
            deleteDoc, 
            doc, 
            updateDoc,
            serverTimestamp 
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        
        // تكوين Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB-Lfs7URKHaMRbouKUd-E3moKec1MQs8U",
            authDomain: "saha-f176d.firebaseapp.com",
            projectId: "saha-f176d",
            storageBucket: "saha-f176d.firebasestorage.app",
            messagingSenderId: "304950545831",
            appId: "1:304950545831:web:5a3ce2906078f71a38ba82",
            measurementId: "G-NGQ29HZRE8"
        };

        // تهيئة Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);

        // تصدير المتغيرات للاستخدام في النطاق العام
        window.db = db;
        window.collection = collection;
        window.addDoc = addDoc;
        window.getDocs = getDocs;
        window.query = query;
        window.where = where;
        window.orderBy = orderBy;
        window.deleteDoc = deleteDoc;
        window.doc = doc;
        window.updateDoc = updateDoc;
        window.serverTimestamp = serverTimestamp;
        
        console.log("✅ Firebase initialized successfully");
    </script>
    <style>
        /* reset متقدم للموبايل */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(145deg, #f4f9ff 0%, #e6f0fa 100%);
            min-height: 100vh;
            min-height: -webkit-fill-available;
            padding: 0;
            margin: 0;
            overflow-x: hidden;
            position: relative;
        }

        /* شاشة تسجيل الدخول - محسنة للموبايل */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(145deg, #0b4f6c, #1e88e5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: 0.5s ease-in-out;
            padding: 20px;
        }

        .login-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 40px;
            padding: 35px 25px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.3);
            text-align: center;
            border: 2px solid rgba(255,255,255,0.5);
            animation: fadeInUp 0.8s;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-icon {
            background: #1e88e5;
            width: 80px;
            height: 80px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 40px;
            box-shadow: 0 15px 25px #1e88e580;
        }

        .login-card h2 {
            color: #0b3b5c;
            font-size: 1.8rem;
            margin-bottom: 8px;
        }

        .login-card p {
            color: #306f94;
            margin-bottom: 25px;
            font-size: 0.95rem;
        }

        .input-group {
            margin-bottom: 20px;
            text-align: right;
        }

        .input-group label {
            display: block;
            margin-bottom: 6px;
            color: #0b4f6c;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .input-group input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #d0e5f5;
            border-radius: 50px;
            font-size: 1rem;
            background: white;
            transition: 0.2s;
            font-family: 'Cairo', sans-serif;
        }

        .input-group input:focus {
            outline: none;
            border-color: #1e88e5;
            box-shadow: 0 0 0 4px #1e88e533;
        }

        .login-btn {
            background: #1e88e5;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 50px;
            width: 100%;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: 0.2s;
            box-shadow: 0 8px 18px #1e88e5;
            border: 2px solid #ffffff90;
        }

        .login-btn:hover {
            background: #0b5fa3;
            transform: scale(1.02);
        }

        .login-btn:active {
            transform: scale(0.98);
        }

        .login-footer {
            margin-top: 20px;
            color: #507e9f;
            font-size: 0.85rem;
        }

        /* المنصة الرئيسية - محسنة للموبايل */
        .platform-container {
            max-width: 100%;
            margin: 0;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 0;
            box-shadow: none;
            padding: 15px 12px 20px;
            border: none;
            opacity: 0;
            transition: 0.5s;
            min-height: 100vh;
            min-height: -webkit-fill-available;
        }

        .platform-container.visible {
            opacity: 1;
        }

        /* رأس محسن للموبايل */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            gap: 10px;
            flex-wrap: nowrap;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }

        .logo-icon {
            background: #1e88e5;
            width: 45px;
            height: 45px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            box-shadow: 0 8px 15px #1e88e533;
        }

        .logo-text h1 {
            font-size: 1.3rem;
            font-weight: 700;
            color: #0b3b5c;
            line-height: 1.2;
        }

        .logo-text p {
            color: #2c5779;
            font-size: 0.7rem;
            font-weight: 500;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
            background: white;
            padding: 5px 12px 5px 8px;
            border-radius: 40px;
            box-shadow: 0 5px 12px rgba(0,0,0,0.02);
            cursor: pointer;
            transition: 0.2s;
            flex-shrink: 1;
            min-width: 0;
        }

        .user-info:active {
            background: #f0f9ff;
        }

        .user-avatar {
            background: #0b4f6c;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .user-name {
            font-weight: 600;
            color: #113448;
            font-size: 0.85rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 80px;
        }

        .user-role {
            font-size: 0.65rem;
            color: #1e88e5;
            background: #e1f0ff;
            padding: 2px 6px;
            border-radius: 30px;
            font-weight: 600;
            white-space: nowrap;
        }

        .logout-btn {
            background: none;
            border: none;
            color: #ff6b6b;
            font-size: 1.1rem;
            cursor: pointer;
            padding: 5px;
            transition: 0.2s;
            flex-shrink: 0;
        }

        .logout-btn:active {
            color: #ff0000;
            transform: scale(1.1);
        }

        /* لوحة الحالة - محسنة */
        .condition-panel {
            background: white;
            border-radius: 25px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px #b3d4f033;
            border: 1px solid #ffffff;
        }

        .section-mini-title {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #154e77;
            margin-bottom: 12px;
            font-weight: 600;
            font-size: 1rem;
        }

        .section-mini-title i {
            background: #1e88e5;
            color: white;
            padding: 6px;
            border-radius: 12px;
            font-size: 0.9rem;
        }

        .condition-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 5px;
        }

        .condition-option {
            background: #f0f7fe;
            color: #1a4c6e;
            padding: 8px 16px;
            border-radius: 40px;
            font-weight: 500;
            cursor: pointer;
            transition: 0.2s;
            border: 2px solid transparent;
            font-size: 0.85rem;
            box-shadow: 0 3px 6px rgba(0,0,0,0.02);
            flex: 1 0 auto;
            text-align: center;
        }

        .condition-option i {
            margin-left: 5px;
            font-size: 0.8rem;
        }

        .condition-option.active {
            background: #1e88e5;
            color: white;
            border-color: #0f5b9e;
            box-shadow: 0 8px 12px #1e88e570;
        }

        /* الشبكة الرئيسية - عمودي للموبايل */
        .main-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 15px;
        }

        /* بطاقة الموعد - محسنة */
        .appointment-card {
            background: linear-gradient(135deg, #0b4f6c, #1d76a5);
            border-radius: 30px;
            padding: 18px;
            color: white;
            box-shadow: 0 15px 25px #0b4f6c40;
        }

        .appointment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            flex-wrap: wrap;
            gap: 8px;
        }

        .appointment-header h3 {
            font-weight: 600;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .badge {
            background: #ffb74d;
            color: #2e3b4e;
            padding: 4px 10px;
            border-radius: 40px;
            font-size: 0.7rem;
            font-weight: 700;
        }

        .appointment-detail {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-radius: 25px;
            padding: 15px;
            margin: 15px 0;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .detail-item i {
            font-size: 1.8rem;
            opacity: 0.9;
            min-width: 35px;
            text-align: center;
        }

        .detail-item .info p {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        .detail-item .info h4 {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .reminder-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .reminder-actions .btn {
            flex: 1 1 auto;
            min-width: 100px;
        }

        .btn {
            padding: 10px 15px;
            border-radius: 40px;
            border: none;
            font-weight: 600;
            font-size: 0.85rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            cursor: pointer;
            transition: 0.2s;
            background: white;
            color: #0b4f6c;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .btn:active {
            transform: scale(0.97);
        }

        .btn-primary {
            background: #ffb74d;
            color: #1f3a4b;
            box-shadow: 0 8px 12px #ffb74d70;
        }

        .btn-outline {
            background: transparent;
            color: white;
            border: 2px solid white;
        }

        .btn-sm {
            padding: 8px 12px;
            font-size: 0.8rem;
        }

        /* بطاقة الحمية - محسنة */
        .diet-card {
            background: white;
            border-radius: 30px;
            padding: 18px;
            box-shadow: 0 10px 20px #b0cfec60;
        }

        .diet-title {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
            font-size: 1.2rem;
            color: #154e77;
        }

        .diet-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .diet-item {
            display: flex;
            align-items: center;
            gap: 12px;
            background: #f6fbfe;
            padding: 10px 15px;
            border-radius: 20px;
            transition: 0.2s;
            border: 1px solid #daeefb;
        }

        .diet-item:active {
            background: #e1f0fa;
        }

        .diet-icon {
            background: #c1e4ff;
            width: 40px;
            height: 40px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #0d4c70;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .diet-content {
            flex: 1;
            min-width: 0;
        }

        .diet-content h4 {
            font-weight: 700;
            color: #133f5c;
            margin-bottom: 2px;
            font-size: 0.95rem;
        }

        .diet-content p {
            color: #306f94;
            font-size: 0.75rem;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .diet-cal {
            background: #e2effa;
            border-radius: 40px;
            padding: 4px 10px;
            font-weight: 700;
            color: #144f70;
            font-size: 0.75rem;
            white-space: nowrap;
        }

        /* النصائح - شبكة محسنة */
        .tips-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .tip-box {
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            padding: 12px;
            border-radius: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 12px rgba(0,0,0,0.02);
            cursor: pointer;
            transition: 0.2s;
        }

        .tip-box:active {
            transform: translateY(-2px);
            background: white;
        }

        .tip-icon {
            background: #bbdefb;
            width: 40px;
            height: 40px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #0c4c70;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .tip-text {
            font-weight: 600;
            color: #173e58;
            font-size: 0.85rem;
        }

        .tip-small {
            font-size: 0.7rem;
            font-weight: 400;
            color: #2b658a;
        }

        /* جدول المواعيد - محسن */
        .reviews-section {
            background: white;
            border-radius: 30px;
            padding: 18px;
            box-shadow: 0 8px 18px rgba(0,0,0,0.02);
            margin-top: 5px;
        }

        .reviews-header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            gap: 10px;
        }

        .reviews-header h3 {
            color: #164f73;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1rem;
        }

        .table-wrapper {
            overflow-x: auto;
            border-radius: 20px;
            -webkit-overflow-scrolling: touch;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
            font-size: 0.85rem;
        }

        th {
            background: #e3f0fa;
            color: #0e4a6e;
            font-weight: 600;
            padding: 12px 8px;
            text-align: center;
            font-size: 0.8rem;
        }

        td {
            padding: 10px 8px;
            border-bottom: 1px solid #cae2f2;
            text-align: center;
            color: #194d6b;
            font-weight: 500;
        }

        .status-badge {
            background: #c8e6c9;
            color: #1f6e2f;
            padding: 3px 8px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 0.7rem;
        }

        .status-badge.warning {
            background: #fff3cd;
            color: #8e6113;
        }

        .action-icon {
            margin: 0 3px;
            cursor: pointer;
            color: #1e88e5;
            font-size: 1.1rem;
            transition: 0.2s;
            padding: 5px;
        }

        .action-icon:active {
            color: #0b4f6c;
            transform: scale(1.2);
        }

        .footer-links {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            color: #306282;
            font-weight: 500;
            font-size: 0.8rem;
            gap: 10px;
        }

        .contact-icons i {
            background: white;
            padding: 10px;
            border-radius: 50%;
            margin: 0 3px;
            color: #1e88e5;
            box-shadow: 0 3px 8px #b3d9fc;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.2s;
        }

        .contact-icons i:active {
            background: #1e88e5;
            color: white;
        }

        .hidden-message {
            display: none;
            background: #4caf50;
            color: white;
            padding: 12px 20px;
            border-radius: 40px;
            text-align: center;
            margin-bottom: 12px;
            font-weight: 600;
            font-size: 0.9rem;
            animation: slideIn 0.3s;
        }

        /* نافذة حجز الموعد - محسنة للموبايل */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 10000;
            align-items: flex-end;
            justify-content: center;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 25px 20px;
            border-radius: 40px 40px 0 0;
            max-width: 100%;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
            border-top: 3px solid #1e88e5;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-content h3 {
            color: #0b4f6c;
            margin-bottom: 15px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 15px;
            text-align: right;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #0b4f6c;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #d0e5f5;
            border-radius: 25px;
            font-size: 0.95rem;
            background: #f9fcff;
            transition: 0.2s;
            font-family: 'Cairo', sans-serif;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #1e88e5;
            box-shadow: 0 0 0 3px #1e88e533;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .modal-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
        }

        .modal-buttons .btn {
            flex: 1;
        }

        .available-slots {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 8px;
            margin-top: 8px;
        }

        .slot-item {
            background: #f0f7fe;
            padding: 8px 5px;
            border-radius: 20px;
            text-align: center;
            cursor: pointer;
            transition: 0.2s;
            border: 2px solid transparent;
            font-size: 0.85rem;
        }

        .slot-item:active {
            background: #1e88e5;
            color: white;
            transform: scale(0.95);
        }

        .slot-item.selected {
            background: #1e88e5;
            color: white;
            border-color: #0f5b9e;
        }

        .condition-info {
            background: #e3f2fd;
            border-radius: 20px;
            padding: 12px;
            margin-bottom: 15px;
            text-align: center;
            color: #0b4f6c;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .loading-spinner {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* تحسينات إضافية للموبايل */
        @media (max-width: 380px) {
            .logo-text h1 {
                font-size: 1.1rem;
            }
            
            .user-name {
                max-width: 60px;
            }
            
            .condition-option {
                padding: 6px 12px;
                font-size: 0.8rem;
            }
            
            .tip-box {
                padding: 8px;
            }
            
            .tip-text {
                font-size: 0.75rem;
            }
            
            .diet-cal {
                font-size: 0.7rem;
                padding: 3px 6px;
            }
        }

        /* تحسين للشاشات الكبيرة */
        @media (min-width: 768px) {
            .platform-container {
                max-width: 700px;
                margin: 0 auto;
                border-radius: 40px;
                padding: 25px;
                min-height: auto;
            }
            
            .modal-content {
                max-width: 500px;
                border-radius: 50px;
                margin: 0 auto;
            }
            
            .modal {
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <!-- شاشة تسجيل الدخول -->
    <div class="login-screen" id="loginScreen">
        <div class="login-card">
            <div class="login-icon">
                <i class="fas fa-heartbeat"></i>
            </div>
            <h2>مرحباً بك</h2>
            <p>أدخل اسمك الثلاثي للدخول إلى المنصة</p>
            <div class="input-group">
                <label>الاسم الثلاثي</label>
                <input type="text" id="fullNameInput" placeholder="مثال: أحمد محمد علي" autocomplete="off">
            </div>
            <button class="login-btn" id="loginBtn">
                <i class="fas fa-sign-in-alt"></i> دخول
            </button>
            <div class="login-footer">
                منصة صحي+ | تطبيق الهاتف
            </div>
        </div>
    </div>

    <!-- المنصة الرئيسية -->
    <div class="platform-container" id="platformContainer">
        <!-- رأس المنصة المحسن -->
        <div class="header">
            <div class="logo-area">
                <div class="logo-icon">
                    <i class="fas fa-heartbeat"></i>
                </div>
                <div class="logo-text">
                    <h1>صحي+</h1>
                    <p>تطبيق الهاتف</p>
                </div>
            </div>
            <div class="user-info" id="userInfo" onclick="showUserProfile()">
                <div class="user-avatar" id="userAvatar">
                    <span>أ</span>
                </div>
                <div>
                    <div class="user-name" id="displayName">أحمد محمد</div>
                    <span class="user-role" id="userCondition">سكري</span>
                </div>
                <i class="fas fa-chevron-down" style="color:#1e88e5; font-size: 0.8rem;"></i>
                <button class="logout-btn" id="logoutBtn" onclick="logout(event)" title="تسجيل الخروج">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>

        <!-- حالة المستخدم الصحية -->
        <div class="condition-panel">
            <div class="section-mini-title">
                <i class="fas fa-notes-medical"></i>
                <span>اختر حالتك</span>
            </div>
            <div class="condition-selector" id="conditionSelector">
                <div class="condition-option active" data-condition="diabetes">
                    <i class="fas fa-sugar"></i> سكري
                </div>
                <div class="condition-option" data-condition="pressure">
                    <i class="fas fa-heart"></i> ضغط
                </div>
                <div class="condition-option" data-condition="heart">
                    <i class="fas fa-heartbeat"></i> قلب
                </div>
            </div>
            <div id="conditionMessage" class="hidden-message"></div>
        </div>

        <!-- الشبكة الرئيسية -->
        <div class="main-grid">
            <!-- بطاقة الموعد القادم -->
            <div class="appointment-card">
                <div class="appointment-header">
                    <h3><i class="fas fa-calendar-check"></i> موعدك</h3>
                    <span class="badge" id="appointmentBadge"><i class="far fa-clock"></i> غير محجوز</span>
                </div>
                <div class="appointment-detail" id="appointmentDetail">
                    <div style="text-align: center; width: 100%; padding: 15px;">
                        <i class="fas fa-calendar-plus" style="font-size: 2.5rem; opacity: 0.8;"></i>
                        <p style="margin-top: 10px; font-size: 1rem;">لا يوجد موعد قادم</p>
                        <p style="font-size: 0.9rem;">احجز موعدك الآن</p>
                    </div>
                </div>
                <div class="reminder-actions">
                    <button class="btn btn-primary" onclick="bookAppointment()"><i class="fas fa-calendar-plus"></i> حجز</button>
                    <button class="btn btn-outline" onclick="showAppointmentHelp()"><i class="fas fa-question-circle"></i> مساعدة</button>
                </div>
            </div>
            <!-- بطاقة الحمية -->
            <div class="diet-card" id="dietCard">
                <div class="diet-title">
                    <i class="fas fa-utensils" style="color: #1e88e5;"></i>
                    <span>حميتك الأساسية</span>
                </div>
                <div class="diet-list" id="dietList"></div>
                <div style="margin-top: 15px; background: #def1ff; border-radius: 20px; padding: 10px; text-align: center; color: #0b4f6c; font-weight: 600; font-size: 0.8rem;">
                    <i class="fas fa-apple-alt"></i> استشر طبيبك
                </div>
            </div>
        </div>

        <!-- نصائح سريعة -->
        <div class="tips-row">
            <div class="tip-box" onclick="showTip('المشي')">
                <div class="tip-icon"><i class="fas fa-walking"></i></div>
                <div>
                    <div class="tip-text">مشي ٣٠ دقيقة</div>
                    <div class="tip-small">يحسن الدورة</div>
                </div>
            </div>
            <div class="tip-box" onclick="showTip('شرب الماء')">
                <div class="tip-icon"><i class="fas fa-tint"></i></div>
                <div>
                    <div class="tip-text">اشرب ٨ أكواب</div>
                    <div class="tip-small">يرطب الجسم</div>
                </div>
            </div>
            <div class="tip-box" onclick="showTip('النوم')">
                <div class="tip-icon"><i class="fas fa-moon"></i></div>
                <div>
                    <div class="tip-text">نوم ٧ ساعات</div>
                    <div class="tip-small">لصحة أفضل</div>
                </div>
            </div>
            <div class="tip-box" onclick="showTip('الاسترخاء')">
                <div class="tip-icon"><i class="fas fa-smile"></i></div>
                <div>
                    <div class="tip-text">تجنب التوتر</div>
                    <div class="tip-small">حافظ على هدوئك</div>
                </div>
            </div>
        </div>

        <!-- جدول المواعيد -->
        <div class="reviews-section">
            <div class="reviews-header">
                <h3><i class="fas fa-calendar-alt"></i> مواعيدي</h3>
                <button class="btn btn-sm" style="background: #1e88e5; color: white;" onclick="bookAppointment()">
                    <i class="fas fa-plus"></i> جديد
                </button>
            </div>
            <div class="table-wrapper">
                <table id="appointmentsTable">
                    <thead>
                        <tr>
                            <th>التاريخ</th>
                            <th>اليوم</th>
                            <th>الطبيب</th>
                            <th>التخصص</th>
                            <th>الحالة</th>
                            <th>الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 30px;">
                                <div class="loading-spinner" style="margin: 0 auto 10px; border-top-color: #1e88e5;"></div>
                                <p style="color: #666;">جاري التحميل...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer-links">
            <div>© 2025 صحي+</div>
            <div class="contact-icons">
                <i class="fab fa-whatsapp" onclick="contact('whatsapp')"></i>
                <i class="fab fa-facebook" onclick="contact('facebook')"></i>
                <i class="fas fa-phone-alt" onclick="contact('phone')"></i>
            </div>
        </div>
    </div>

    <!-- نافذة حجز الموعد -->
    <div class="modal" id="bookingModal">
        <div class="modal-content">
            <h3><i class="fas fa-calendar-plus"></i> حجز موعد</h3>
            <div class="condition-info" id="bookingConditionInfo">
                <!-- يتم تعبئتها عبر JS -->
            </div>
            <form id="bookingForm" onsubmit="submitBooking(event)">
                <div class="form-group">
                    <label>اختر الطبيب</label>
                    <select id="doctorSelect" required onchange="updateDoctorInfo()">
                        <option value="">اختر الطبيب</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>التاريخ</label>
                    <input type="date" id="appointmentDate" required onchange="updateAvailableSlots()">
                </div>
                <div class="form-group">
                    <label>المواعيد المتاحة</label>
                    <div class="available-slots" id="availableSlots">
                        <!-- يتم تعبئتها عبر JS -->
                    </div>
                </div>
                <div class="form-group">
                    <label>ملاحظات</label>
                    <textarea id="notes" placeholder="أي ملاحظات..."></textarea>
                </div>
                <div class="modal-buttons">
                    <button type="submit" class="btn btn-primary" id="submitBookingBtn">تأكيد</button>
                    <button type="button" class="btn" onclick="closeBookingModal()">إلغاء</button>
                </div>
            </form>
        </div>
    </div>

    <!-- نافذة الإشعارات -->
    <div class="modal" id="notificationModal">
        <div class="modal-content">
            <h3 id="modalTitle">إشعار</h3>
            <p id="modalMessage" style="margin: 15px 0;"></p>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="closeModal()">حسناً</button>
            </div>
        </div>
    </div>

    <script type="module">
        // استيراد Firebase (تم استيراده في الأعلى)
        
        // بيانات الحميات
        const dietData = {
            diabetes: [
                { icon: 'fa-bread-slice', name: 'خبز أسمر', desc: 'حبة يومياً', cal: '١٥٠' },
                { icon: 'fa-fish', name: 'بروتين مشوي', desc: 'سمك أو دجاج', cal: '٢٠٠' },
                { icon: 'fa-carrot', name: 'خضروات', desc: 'خيار، بروكلي', cal: '٥٠' },
                { icon: 'fa-apple', name: 'فواكه', desc: 'تفاح، فراولة', cal: '٨٠' }
            ],
            pressure: [
                { icon: 'fa-leaf', name: 'خضروات', desc: 'سبانخ، بطاطا', cal: '١٠٠' },
                { icon: 'fa-ban', name: 'تجنب الملح', desc: 'استبدله بالليمون', cal: '٠' },
                { icon: 'fa-seedling', name: 'موز', desc: 'مصدر بوتاسيوم', cal: '١٠٥' },
                { icon: 'fa-glass-water', name: 'كركديه', desc: 'يخفض الضغط', cal: '٥' }
            ],
            heart: [
                { icon: 'fa-fish', name: 'سلمون', desc: 'أوميغا ٣', cal: '٢٥٠' },
                { icon: 'fa-oil', name: 'زيت زيتون', desc: 'دهون صحية', cal: '١٢٠' },
                { icon: 'fa-seedling', name: 'مكسرات', desc: 'لوز، جوز', cal: '١٨٠' },
                { icon: 'fa-apple', name: 'شوفان', desc: 'للكوليسترول', cal: '١٥٠' }
            ]
        };

        // بيانات الأطباء حسب الحالة
        const doctorsByCondition = {
            diabetes: [
                { name: 'د. سارة علي', specialty: 'غدد صماء', clinic: 'عيادة السكري' },
                { name: 'د. محمد نور', specialty: 'باطنة', clinic: 'عيادة الباطنة' }
            ],
            pressure: [
                { name: 'د. أحمد فتحي', specialty: 'قلب', clinic: 'عيادة الضغط' },
                { name: 'د. خالد يوسف', specialty: 'باطنة', clinic: 'عيادة الباطنة' }
            ],
            heart: [
                { name: 'د. أحمد فتحي', specialty: 'قلب', clinic: 'عيادة القلب' },
                { name: 'د. ليلى محمود', specialty: 'تغذية', clinic: 'عيادة التغذية' }
            ]
        };

        // بيانات المستخدم
        let currentUser = {
            name: '',
            condition: 'diabetes',
            id: null
        };

        // عناصر DOM
        const loginScreen = document.getElementById('loginScreen');
        const platformContainer = document.getElementById('platformContainer');
        const fullNameInput = document.getElementById('fullNameInput');
        const loginBtn = document.getElementById('loginBtn');
        const displayName = document.getElementById('displayName');
        const userAvatar = document.getElementById('userAvatar');
        const userCondition = document.getElementById('userCondition');
        const dietListEl = document.getElementById('dietList');
        const conditionMessage = document.getElementById('conditionMessage');
        const tableBody = document.getElementById('tableBody');
        const notificationModal = document.getElementById('notificationModal');
        const bookingModal = document.getElementById('bookingModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const appointmentDetail = document.getElementById('appointmentDetail');
        const appointmentBadge = document.getElementById('appointmentBadge');
        const doctorSelect = document.getElementById('doctorSelect');
        const bookingConditionInfo = document.getElementById('bookingConditionInfo');
        const submitBookingBtn = document.getElementById('submitBookingBtn');

        // تهيئة المصفوفة
        window.appointments = [];

        // التحقق من وجود مستخدم مسجل
        window.onload = async function() {
            const savedUser = localStorage.getItem('healthPlatformUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                updateUserInfo();
                showPlatform();
            }
            renderDiet(currentUser.condition);
            
            // تحميل المواعيد من Firebase
            await loadAppointmentsFromFirebase();
            
            updateConditionSelector();
            
            // تعيين أقل تاريخ هو اليوم
            const today = new Date().toISOString().split('T')[0];
            const dateInput = document.getElementById('appointmentDate');
            if (dateInput) {
                dateInput.min = today;
            }
        };

        // تحميل المواعيد من Firebase
        async function loadAppointmentsFromFirebase() {
            try {
                const appointmentsRef = collection(window.db, 'appointments');
                const q = query(appointmentsRef, orderBy('date', 'asc'));
                const querySnapshot = await getDocs(q);
                
                // تجهيز المصفوفة
                window.appointments = [];
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    window.appointments.push({
                        id: doc.id,
                        ...data
                    });
                });
                
                renderAppointmentsTable();
            } catch (error) {
                console.error("Error loading appointments:", error);
                showNotification('خطأ', 'حدث خطأ في تحميل المواعيد');
                renderAppointmentsTable();
            }
        }

        // تسجيل الدخول
        loginBtn.addEventListener('click', async function() {
            const fullName = fullNameInput.value.trim();

            if (fullName === '') {
                showNotification('تنبيه', 'الرجاء إدخال الاسم الثلاثي');
                return;
            }

            // التحقق من أن الاسم ثلاثي
            const nameParts = fullName.split(' ').filter(part => part.trim() !== '');
            if (nameParts.length < 3) {
                showNotification('تنبيه', 'الرجاء إدخال الاسم الثلاثي كاملاً');
                return;
            }

            currentUser = {
                name: fullName,
                condition: 'diabetes'
            };

            localStorage.setItem('healthPlatformUser', JSON.stringify(currentUser));
            updateUserInfo();
            renderDiet(currentUser.condition);
            showPlatform();
            
            // تحميل المواعيد بعد تسجيل الدخول
            await loadAppointmentsFromFirebase();
            
            showNotification('مرحباً بك', `أهلاً ${fullName}`);
        });

        // السماح بالدخول بالضغط على Enter
        fullNameInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') loginBtn.click();
        });

        // تسجيل الخروج
        window.logout = function(e) {
            e.stopPropagation();
            localStorage.removeItem('healthPlatformUser');
            currentUser = { name: '', condition: 'diabetes' };
            platformContainer.classList.remove('visible');
            loginScreen.classList.remove('hidden');
            fullNameInput.value = '';
            window.appointments = [];
            renderAppointmentsTable();
            showNotification('تسجيل الخروج', 'تم تسجيل الخروج بنجاح');
        };

        function updateUserInfo() {
            const firstName = currentUser.name.split(' ')[0];
            displayName.textContent = currentUser.name;
            userAvatar.innerHTML = `<span>${firstName.charAt(0)}</span>`;
            
            let conditionText = '';
            if (currentUser.condition === 'diabetes') conditionText = 'سكري';
            else if (currentUser.condition === 'pressure') conditionText = 'ضغط';
            else conditionText = 'قلب';
            userCondition.textContent = conditionText;
        }

        function showPlatform() {
            loginScreen.classList.add('hidden');
            platformContainer.classList.add('visible');
        }

        // تحديث اختيار الحالة
        function updateConditionSelector() {
            document.querySelectorAll('.condition-option').forEach(opt => {
                opt.classList.remove('active');
                if (opt.dataset.condition === currentUser.condition) {
                    opt.classList.add('active');
                }
            });
        }

        // عرض الحمية
        function renderDiet(conditionKey) {
            const items = dietData[conditionKey];
            dietListEl.innerHTML = '';
            items.forEach(item => {
                const dietItem = document.createElement('div');
                dietItem.className = 'diet-item';
                dietItem.innerHTML = `
                    <div class="diet-icon"><i class="fas ${item.icon}"></i></div>
                    <div class="diet-content">
                        <h4>${item.name}</h4>
                        <p>${item.desc}</p>
                    </div>
                    <div class="diet-cal">${item.cal}</div>
                `;
                dietListEl.appendChild(dietItem);
            });
        }

        // عرض المواعيد في الجدول
        function renderAppointmentsTable() {
            if (!window.appointments || window.appointments.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 30px;">
                            <i class="fas fa-calendar-times" style="font-size: 2.5rem; color: #ccc; margin-bottom: 10px;"></i>
                            <p style="color: #666;">لا توجد مواعيد</p>
                            <button class="btn btn-sm" style="background: #1e88e5; color: white; margin-top: 10px;" onclick="bookAppointment()">
                                <i class="fas fa-plus"></i> احجز الآن
                            </button>
                        </td>
                    </tr>
                `;
                // إخفاء الموعد القادم
                appointmentDetail.innerHTML = `
                    <div style="text-align: center; width: 100%; padding: 15px;">
                        <i class="fas fa-calendar-plus" style="font-size: 2.5rem; opacity: 0.8;"></i>
                        <p style="margin-top: 10px;">لا يوجد موعد</p>
                    </div>
                `;
                appointmentBadge.innerHTML = '<i class="far fa-clock"></i> لا يوجد';
                return;
            }

            // ترتيب المواعيد حسب التاريخ
            window.appointments.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            tableBody.innerHTML = '';
            window.appointments.forEach((apt, index) => {
                const dateObj = new Date(apt.date + 'T12:00:00');
                const dayNames = ['الأحد', 'الإثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'];
                const dayName = dayNames[dateObj.getDay()];
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${apt.date}</td>
                    <td>${dayName}</td>
                    <td>${apt.doctor}</td>
                    <td>${apt.specialty}</td>
                    <td>${apt.condition || '-'}</td>
                    <td>
                        <i class="fas fa-eye action-icon" onclick="viewAppointment('${apt.id}')" title="عرض"></i>
                        <i class="fas fa-video action-icon" onclick="videoCall('${apt.doctor}')" title="مرئي"></i>
                        <i class="fas fa-times-circle action-icon" style="color: #ff6b6b;" onclick="cancelAppointment('${apt.id}')" title="إلغاء"></i>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            // تحديث الموعد القادم
            const nextAppointment = window.appointments[0];
            const dateObj = new Date(nextAppointment.date + 'T12:00:00');
            const today = new Date();
            const diffTime = dateObj - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            let badgeText = '';
            if (diffDays < 0) badgeText = 'موعد سابق';
            else if (diffDays === 0) badgeText = 'اليوم';
            else if (diffDays === 1) badgeText = 'غداً';
            else badgeText = `خلال ${diffDays} أيام`;

            appointmentDetail.innerHTML = `
                <div class="detail-item">
                    <i class="fas fa-user-md"></i>
                    <div class="info">
                        <p>دكتور</p>
                        <h4>${nextAppointment.doctor}</h4>
                    </div>
                </div>
                <div class="detail-item">
                    <i class="fas fa-calendar-alt"></i>
                    <div class="info">
                        <p>التاريخ</p>
                        <h4>${nextAppointment.date}</h4>
                    </div>
                </div>
                <div class="detail-item">
                    <i class="fas fa-clock"></i>
                    <div class="info">
                        <p>الساعة</p>
                        <h4>${nextAppointment.time}</h4>
                    </div>
                </div>
            `;
            appointmentBadge.innerHTML = `<i class="far fa-clock"></i> ${badgeText}`;
        }

        // حجز موعد جديد
        window.bookAppointment = function() {
            if (!currentUser.name) {
                showNotification('تنبيه', 'الرجاء تسجيل الدخول أولاً');
                return;
            }
            
            // عرض الحالة الحالية في نافذة الحجز
            let conditionText = '';
            if (currentUser.condition === 'diabetes') conditionText = 'السكري';
            else if (currentUser.condition === 'pressure') conditionText = 'الضغط';
            else conditionText = 'القلب';
            
            bookingConditionInfo.innerHTML = `<i class="fas fa-info-circle"></i> حالتك: ${conditionText}`;
            
            // تحديث قائمة الأطباء حسب الحالة
            updateDoctorsList();
            
            bookingModal.classList.add('show');
        };

        // تحديث قائمة الأطباء حسب الحالة
        function updateDoctorsList() {
            const doctors = doctorsByCondition[currentUser.condition];
            doctorSelect.innerHTML = '<option value="">اختر الطبيب</option>';
            
            doctors.forEach(doctor => {
                const option = document.createElement('option');
                option.value = doctor.name;
                option.textContent = `${doctor.name} (${doctor.specialty})`;
                doctorSelect.appendChild(option);
            });
        }

        // تحديث معلومات الطبيب
        window.updateDoctorInfo = function() {
            // يمكن إضافة أي منطق إضافي
        };

        // تحديث المواعيد المتاحة
        window.updateAvailableSlots = async function() {
            const doctor = document.getElementById('doctorSelect').value;
            const date = document.getElementById('appointmentDate').value;
            const slotsContainer = document.getElementById('availableSlots');
            
            if (!doctor || !date) {
                slotsContainer.innerHTML = '<p style="grid-column: 1/-1;">اختر الطبيب والتاريخ</p>';
                return;
            }

            // مواعيد افتراضية
            const slots = ['09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00'];
            
            try {
                const appointmentsRef = collection(window.db, 'appointments');
                const q = query(appointmentsRef, 
                    where('doctor', '==', doctor),
                    where('date', '==', date)
                );
                const querySnapshot = await getDocs(q);
                
                const bookedSlots = [];
                querySnapshot.forEach((doc) => {
                    bookedSlots.push(doc.data().time);
                });

                slotsContainer.innerHTML = '';
                slots.forEach(slot => {
                    if (!bookedSlots.includes(slot)) {
                        const slotDiv = document.createElement('div');
                        slotDiv.className = 'slot-item';
                        slotDiv.textContent = slot;
                        slotDiv.onclick = function() {
                            document.querySelectorAll('.slot-item').forEach(s => s.classList.remove('selected'));
                            this.classList.add('selected');
                        };
                        slotsContainer.appendChild(slotDiv);
                    }
                });

                if (slotsContainer.children.length === 0) {
                    slotsContainer.innerHTML = '<p style="grid-column: 1/-1; color: #ff6b6b;">لا توجد مواعيد</p>';
                }
            } catch (error) {
                console.error("Error checking slots:", error);
                showNotification('خطأ', 'حدث خطأ');
            }
        };

        // تقديم الحجز
        window.submitBooking = async function(event) {
            event.preventDefault();
            
            const doctor = document.getElementById('doctorSelect').value;
            const date = document.getElementById('appointmentDate').value;
            const selectedSlot = document.querySelector('.slot-item.selected');
            const notes = document.getElementById('notes').value;

            if (!doctor || !date || !selectedSlot) {
                showNotification('تنبيه', 'اختر الطبيب والتاريخ والموعد');
                return;
            }

            const time = selectedSlot.textContent;
            
            submitBookingBtn.disabled = true;
            submitBookingBtn.innerHTML = '<span class="loading-spinner"></span> جاري...';
            
            try {
                const doctors = doctorsByCondition[currentUser.condition];
                const selectedDoctor = doctors.find(d => d.name === doctor);
                const specialty = selectedDoctor ? selectedDoctor.specialty : '';

                let conditionText = '';
                if (currentUser.condition === 'diabetes') conditionText = 'سكري';
                else if (currentUser.condition === 'pressure') conditionText = 'ضغط';
                else conditionText = 'قلب';

                const appointmentsRef = collection(window.db, 'appointments');
                const docRef = await addDoc(appointmentsRef, {
                    date: date,
                    doctor: doctor,
                    specialty: specialty,
                    time: time,
                    notes: notes,
                    condition: conditionText,
                    patientName: currentUser.name,
                    patientCondition: currentUser.condition,
                    createdAt: serverTimestamp(),
                    status: 'مؤكد'
                });

                if (!window.appointments) window.appointments = [];
                window.appointments.push({
                    id: docRef.id,
                    date: date,
                    doctor: doctor,
                    specialty: specialty,
                    time: time,
                    notes: notes,
                    condition: conditionText,
                    patientName: currentUser.name,
                    patientCondition: currentUser.condition,
                    status: 'مؤكد'
                });

                renderAppointmentsTable();
                closeBookingModal();
                showNotification('تم', 'تم الحجز بنجاح');
            } catch (error) {
                console.error("Error booking:", error);
                showNotification('خطأ', 'فشل الحجز');
            } finally {
                submitBookingBtn.disabled = false;
                submitBookingBtn.innerHTML = 'تأكيد';
            }
        };

        // إلغاء الموعد
        window.cancelAppointment = async function(appointmentId) {
            if (confirm('إلغاء الموعد؟')) {
                try {
                    await deleteDoc(doc(window.db, 'appointments', appointmentId));
                    window.appointments = window.appointments.filter(apt => apt.id !== appointmentId);
                    renderAppointmentsTable();
                    showNotification('تم', 'تم الإلغاء');
                } catch (error) {
                    console.error("Error canceling:", error);
                    showNotification('خطأ', 'فشل الإلغاء');
                }
            }
        };

        // عرض تفاصيل الموعد
        window.viewAppointment = function(appointmentId) {
            const apt = window.appointments.find(a => a.id === appointmentId);
            if (apt) {
                showNotification('التفاصيل', 
                    `د. ${apt.doctor}\n${apt.date} ${apt.time}\n${apt.condition || ''}`);
            }
        };

        // مراجعة عن بعد
        window.videoCall = function(doctor) {
            showNotification('مرئي', `جاري الاتصال بـ ${doctor}`);
        };

        // نصائح
        window.showTip = function(tip) {
            const tips = {
                'المشي': 'المشي 30 دقيقة يومياً يحسن الدورة',
                'شرب الماء': '8 أكواب ماء يومياً ترطب الجسم',
                'النوم': 'النوم 7 ساعات يقوي المناعة',
                'الاسترخاء': 'تجنب التوتر لصحة القلب'
            };
            showNotification('نصيحة', tips[tip]);
        };

        // التواصل
        window.contact = function(channel) {
            let msg = '';
            if (channel === 'whatsapp') msg = 'واتساب: 800123456';
            else if (channel === 'facebook') msg = 'فيسبوك: @sehaplus';
            else msg = 'اتصل: 800123456';
            showNotification('تواصل', msg);
        };

        // عرض الملف الشخصي
        window.showUserProfile = function() {
            let conditionText = '';
            if (currentUser.condition === 'diabetes') conditionText = 'سكري';
            else if (currentUser.condition === 'pressure') conditionText = 'ضغط';
            else conditionText = 'قلب';
            
            showNotification('ملفي', `${currentUser.name}\nالحالة: ${conditionText}`);
        };

        // مساعدة الموعد
        window.showAppointmentHelp = function() {
            showNotification('مساعدة', 'اضغط "حجز" لموعد جديد');
        };

        // إغلاق نوافذ
        window.closeBookingModal = function() {
            bookingModal.classList.remove('show');
            document.getElementById('bookingForm').reset();
            document.getElementById('availableSlots').innerHTML = '';
        };

        window.closeModal = function() {
            notificationModal.classList.remove('show');
        };

        // إظهار الإشعارات
        function showNotification(title, message) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            notificationModal.classList.add('show');
        }

        // إغلاق المودال بالضغط خارج المحتوى
        notificationModal.addEventListener('click', function(e) {
            if (e.target === notificationModal) closeModal();
        });
        bookingModal.addEventListener('click', function(e) {
            if (e.target === bookingModal) closeBookingModal();
        });

        // تحديث الحالة من المنصة
        document.querySelectorAll('.condition-option').forEach(opt => {
            opt.addEventListener('click', function() {
                document.querySelectorAll('.condition-option').forEach(o => o.classList.remove('active'));
                this.classList.add('active');
                currentUser.condition = this.dataset.condition;
                
                localStorage.setItem('healthPlatformUser', JSON.stringify(currentUser));
                
                let conditionName = '';
                if (currentUser.condition === 'diabetes') conditionName = 'سكري';
                else if (currentUser.condition === 'pressure') conditionName = 'ضغط';
                else conditionName = 'قلب';
                
                renderDiet(currentUser.condition);
                userCondition.textContent = conditionName;
                
                conditionMessage.style.display = 'block';
                conditionMessage.textContent = `✅ تم التحديث إلى: ${conditionName}`;
                setTimeout(() => {
                    conditionMessage.style.display = 'none';
                }, 2000);
            });
        });
    </script>
</body>
</html>